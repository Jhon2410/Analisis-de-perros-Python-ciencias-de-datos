<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>web</title>
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
    />
    <link
    href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    rel="stylesheet"
    />
    <!-- MDB -->
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.css"
    rel="stylesheet"
    />
</head>
<body class="bg-primary text-white">
    <div id="dropContainer" onclick="abrirArchivos()" class="container my-3" style="border:3px dashed rgb(255, 255, 255);height:100px;">
        Click or Drop Here the dog Image
     </div>
    <form method="post" id="formulario" class="text-center my-3" action="http://localhost:5000/">
        <input type="file" hidden required name="file" id="fileInput" />
        <button type="submit" class="btn btn-success mx-auto ">Analizar</button>
    </form>
       
    <div class="card mx-auto d-flex position-relative" style="max-width: 500px;">
        <div>
            <h5 id="razaName" class="text-center position-absolute top-0 w-100" style="filter: drop-shadow(2px 4px 6px black);"></h5>
            <img id="imgPerro" class="card-img-top" width="350px" />
        </div>
        <div class="card-body" style="width:100%; height: 100%;"> 
        <canvas id="myChart" style="width:100%;max-width:600px" ></canvas>
        </div>
      </div>

</form> 
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script>
    const formulario = document.getElementById("formulario")
    const imgPerro = document.getElementById("imgPerro")
    const razaName = document.getElementById("razaName")

    formulario.addEventListener("submit",async(e)=>{
        e.preventDefault();
        const datos = new FormData()
        datos.append("chandozo", formulario[0].files[0])
        const base_url = "http://localhost:5000"
        const res= await axios.post(`${base_url}/api/upload`,datos)
        if(res.status===200){
            res.data.data = res.data.data ? await JSON.parse(res.data.data) : null
            console.log(res.data)
            razaName.innerText= res.data.data[0].raza
            const xValues = [];
            const yValues = [];
            res.data.data.map(perro=>{
                xValues.push(perro.raza)
                yValues.push(perro.procentaje)
            })
           
            const barColors = [
            "#b91d47",
            "#00aba9",
            "#2b5797",
            "#e8c3b9",
            "#1e7145"
            ];
            
            new Chart("myChart", {
            type: "doughnut",
            data: {
                labels: xValues,
                datasets: [{
                backgroundColor: barColors,
                data: yValues
                }]
            },
            options: {
                title: {
                display: true,
                text: "Probabilidad de raza."
                }
            }
    });
             scroll(0,document.body.scrollHeight);
       

        }
    })
   
    dropContainer.ondragover = dropContainer.ondragenter = function(e) {
    e.preventDefault();
    };

    dropContainer.ondrop =   function(evt) {
    evt.preventDefault();
    fileInput.files = evt.dataTransfer.files;
    const dT = new DataTransfer();
    dT.items.add(evt.dataTransfer.files[0]);
    fileInput.files = dT.files;
    const imgURL = URL.createObjectURL(formulario[0].files[0]);
    imgPerro.src = imgURL
    myChart.width=myChart.width;
    razaName.innerText=""
    };

 
    function abrirArchivos(evt){
        fileInput.click()
    }
</script>
<!-- MDB -->
<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/4.3.0/mdb.min.js"
></script>

</html>